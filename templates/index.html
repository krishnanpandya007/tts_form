<!-- <!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Audio Input Form</title>
</head>
<body>
  <h1>Audio Input Form</h1>

  <form id="audioForm">
    <label for="name">Name:</label>
    <input type="text" id="name" name="name" required>
    <button class="speakButton" data-field="name">Speak</button><br><br>

    <label for="city">Name of City:</label>
    <input type="text" id="city" name="city" required>
    <button class="speakButton" data-field="city">Speak</button><br><br>

    <label for="district">District:</label>
    <input type="text" id="district" name="district" required>
    <button class="speakButton" data-field="district">Speak</button><br><br>

    <label for="mobile">Mobile Number:</label>
    <input type="text" id="mobile" name="mobile" required>
    <button class="speakButton" data-field="mobile">Speak</button><br><br>

    <button type="submit">Submit</button>
  </form>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    // Function to handle recording audio and sending it to the backend
    function handleAudioRecording(fieldId) {
      const mediaRecorderChunks = [];
      let mediaRecorder;

      navigator.mediaDevices.getUserMedia({ audio: true })
        .then((stream) => {
          mediaRecorder = new MediaRecorder(stream);
          mediaRecorder.start();

          mediaRecorder.addEventListener('dataavailable', (event) => {
            mediaRecorderChunks.push(event.data);
          });
        })
        .catch((error) => {
          console.error('Error accessing microphone:', error);
        });

      setTimeout(() => {
        mediaRecorder.stop();

        const audioBlob = new Blob(mediaRecorderChunks, { type: 'audio/webm' });
        const formData = new FormData();
        formData.append('audioFile', audioBlob, 'recording.webm');

        $.ajax({
          url: '/extract_text/',
          type: 'POST',
          data: formData,
          processData: false,
          contentType: false,
          success: function(response) {
            if (response.success) {
              const extractedText = response.data.text;
              $('#' + fieldId).val(extractedText);
            } else if (response.error) {
              console.error('Error:', response.error);
            }
          },
          error: function(xhr, status, error) {
            console.error('Error:', error);
          }
        });
      }, 5000); // Set the recording duration (in milliseconds)
    }

    $(document).ready(function() {
      // Add event listener to all speak buttons
      $('.speakButton').on('click', function() {
        const fieldId = $(this).data('field');
        handleAudioRecording(fieldId);
      });

      // Submit form
      $('#audioForm').on('submit', function(event) {
        event.preventDefault();

        // Submit form data to the backend
        const formData = new FormData(this);

        $.ajax({
          url: '/api/submit_form/',
          type: 'POST',
          data: formData,
          processData: false,
          contentType: false,
          success: function(response) {
            if (response.success) {
              // Handle success response
              console.log('Form submitted successfully!');
            } else if (response.error) {
              console.error('Error:', response.error);
            }
          },
          error: function(xhr, status, error) {
            console.error('Error:', error);
          }
        });
      });
    });
  </script>
</body>
</html> -->
<!-- 

<!DOCTYPE html>
<html>
<head>
    <title>Audio Recording</title>
    <script>
        // JavaScript code for recording audio
        let mediaRecorder;
        let chunks = [];

        function startRecording() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(function(stream) {
                    mediaRecorder = new MediaRecorder(stream);

                    mediaRecorder.addEventListener('dataavailable', function(e) {
                        chunks.push(e.data);
                    });

                    mediaRecorder.start();
                })
                .catch(function(err) {
                    console.log('Error: ' + err);
                });
        }

        function stopRecording() {
            mediaRecorder.stop();

            mediaRecorder.addEventListener('stop', function() {
                const audioBlob = new Blob(chunks, { type: 'audio/webm' });
                const audioUrl = URL.createObjectURL(audioBlob);

                const formData = new FormData();
                formData.append('audio', audioBlob, 'recorded_audio.webm');

                fetch("{% url 'formfill:index' %}", {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                })
                .then(function(response) {
                    console.log('Audio sent to the server');
                })
                .catch(function(err) {
                    console.log('Error: ' + err);
                });
            });

            chunks = [];
        }

        // Function to get the CSRF token from the cookies
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</head>
<body>
    <h1>Audio Recording</h1>
    <button onclick="startRecording()">Start Recording</button>
    <button onclick="stopRecording()">Stop Recording</button>

    {% csrf_token %}
</body>
</html> -->


<!DOCTYPE html>
<html>
<head>
    <title>Audio Recording</title>
    <script>
        let mediaRecorder;
        let chunks = [];

        function startRecording() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(function(stream) {
                    mediaRecorder = new MediaRecorder(stream);

                    mediaRecorder.addEventListener('dataavailable', function(e) {
                        chunks.push(e.data);
                    });

                    mediaRecorder.start();
                })
                .catch(function(err) {
                    console.log('Error: ' + err);
                });
        }

        function stopRecording() {
            mediaRecorder.stop();

            mediaRecorder.addEventListener('stop', function() {
                const audioBlob = new Blob(chunks, { type: 'audio/wav' });

                const formData = new FormData();
                formData.append('audio', audioBlob, 'recorded_audio.wav');

                fetch("{% url 'formfill:index' %}", {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                })
                    .then(function(response) {
                        console.log('Audio sent to the server');
                    })
                    .catch(function(err) {
                        console.log('Error: ' + err);
                    });
            });

            chunks = [];
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</head>
<body>
    <h1>Audio Recording</h1>
    <button onclick="startRecording()">Start Recording</button>
    <button onclick="stopRecording()">Stop Recording</button>

    {% csrf_token %}
</body>
</html>
